<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">

    <title>Stormworks Lua</title>
    <meta name="title" content="Stormworks Lua">


    <!-- favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
    <link rel="manifest" href="favicon/site.webmanifest">
    <link rel="mask-icon" href="favicon/safari-pinned-tab.svg" color="#000000">
    <link rel="shortcut icon" href="favicon/favicon.ico">
    <meta name="msapplication-TileColor" content="#000000">
    <meta name="msapplication-config" content="favicon/browserconfig.xml">
    <meta name="theme-color" content="#000000">






    <link rel="stylesheet" type="text/css" href="stylesheets/style.css">
    <link rel="stylesheet" type="text/css" href="stylesheets/iconfont.css">
    <link rel="stylesheet" type="text/css" href="stylesheets/jquery_ui.css">
    <link rel="stylesheet" type="text/css" href="stylesheets/incognito.css">

    <script type="text/javascript" src="scripts/jquery.js"></script>
    <script type="text/javascript" src="scripts/jquery_ui.js"></script>
    <script type="text/javascript" id="fengari-script" src="scripts/fengari_web.js"></script>
    <script type="text/javascript" src="scripts/share.js"></script>
    <script type="text/javascript" src="scripts/script.js"></script>
    <script type="text/javascript" src="scripts/canvas.js"></script>
    <script type="text/javascript" src="scripts/ui_builder.js"></script>
    <script type="text/javascript" src="scripts/paint.js"></script>
    <script type="text/javascript" src="scripts/map.js"></script>
    <script type="text/javascript" src="scripts/input.js"></script>
    <script type="text/javascript" src="scripts/output.js"></script>
    <script type="text/javascript" src="scripts/property.js"></script>
    <script type="text/javascript" src="scripts/stormworks_lua_api.js"></script>
    <script type="text/javascript" src="scripts/lua_emulator.js"></script>
    <script type="text/javascript" src="scripts/editor_autocompletition.js"></script>
    <script type="text/javascript" src="scripts/luaparse.js"></script>
    <script type="text/javascript" src="scripts/luamin.js"></script>
    <script type="text/javascript" src="scripts/examples.js"></script>
</head>
<body>
    <script type="text/javascript">
        if(new URLSearchParams(window.location.search).has("incognito")){
            /*let link = document.createElement('link', )
            link.setAttribute('rel', 'stylesheet')
            link.setAttribute('type', 'text/css')
            link.setAttribute('href', 'stylesheets/incognito.css')
            document.head.appendChild(link)*/
            document.body.className += " incognito "
        }
    </script>
  <div id="background"></div>
  <div class="content">
      <div id="mobile-menu">
        <div id="mobile-menu-inner">
            <div class="mobile_menu_logo">
                <img src="images/pony.png">
            </div>
            <div class="menu_group">
                <div class="menu_group_title">Page Navigation</div>
                <a href="#editor">Code</a>
                <a href="#documentation">Available Functions</a>
                <div id="learn-menu-entry"><span>Learn & Examples</span></div>
                <div id="help-menu-entry"><span>Help / Manual</span></div>
                <a href="?incognito">@work mode (no fancy colors)</a>
            </div>
            <div class="menu_group">
                <div class="menu_group_title">Contact me</div>
                <span>Discord: CrazyFluffyPony#0587</span>
                <a href="mailto://crazyfluffypony@gmail.com">crazyfluffypony@gmail.com</a>
            </div>
            <div class="menu_group">
                <div class="menu_group_title">Other Information</div>
                <a href="https://www.lua.org/manual/5.3/" target="_blank" rel="noopener noreferrer">Official Lua manual</a>
                <a target="_blank" rel="noopener noreferrer" href="https://gitlab.com/stormworks-lua-editor/editor">View source code</a>
            </div>
        </div>
        <div id="mobile-menu-close-sidebar"></div>
      </div>
    <div id="navigation">
        <div id="mobile-menu-open" style="display: none;"></div>
        <div id="logo"></div>
        <div style="display: none" id="beta">Beta</div>
        <div style="display: none" id="offline">Offline</div>
        <a id="download-offline" href="https://gitlab.com/stormworks-lua-editor/editor/-/archive/master/editor-master.zip" download="" rel="nofollow">Download for offline use</a>
        
    </div>
    <div id="selection">
        <div class="selection_group">
            <label for="monitor-size">Monitor</label>
            <select id="monitor-size" name="monitor-size">
                <option value="1x1">1x1</option>
                <option value="2x2">2x2</option>
                <option value="3x3">3x3</option>
                <option value="5x3">5x3</option>
                <option value="9x5">9x5</option>
            </select>            
        </div>
        <div class="selection_group">
            <label for="show-overflow">Show overflow</label>
            <input type="checkbox" id="show-overflow" name="show-overflow" checked>
        </div>
        <div class="selection_group">
            <label for="enable-touchscreen">Enable Touchscreen</label>
            <input type="checkbox" id="enable-touchscreen" name="enable-touchscreen">
        </div>
        <div class="selection_group">            
            <div class="time_between">
                <label>Time between ticks (ms): <span id="timeBetweenTicksVal">200 ms</span></label>
                <input type="range" min="20" max="2000" value="200" id="timeBetweenTicks">
                <span>Average time for a tick:<span id="ticktime">0 ms</span></span>
            </div>
        </div>        
        <div class="selection_group"> 
            <div class="time_between">
                <label>Time between draws (ms): <span id="timeBetweenDrawsVal">500 ms</span></label>
                <input type="range" min="50" max="5000" value="500" id="timeBetweenDraws">
                <span>Average time for a draw:<span id="drawtime">0 ms</span></span>
            </div>
        </div>
    </div>
    <div id="top">
        <div id="property" class="value_list"></div>
        <div id="input" class="value_list"></div>
        <div id="monitor-container">
            <div id="monitor">
                <canvas id="canvas"></canvas>
                <div id="overflow"></div>
            </div>
            <div id="monitor-sizes">
                <div>Width <span class="width">0</span>px</div>
                <div>Height <span class="height">0</span>px</div>
            </div>
            <div class="zoomfactor">
                <label for="zoomfactor">Monitor Zoom: <span>3x</span></label>
                <input type="range" min="1" max="4" id="zoomfactor" name="zoomfactor" value="1">
            </div>
        </div>
        <div id="output" class="value_list"></div>
    </div>
    <div id="editor">
        <div class="controls">
            <div class="controls_container">
                <button id="save">Save</button>          
            </div>
            <div class="controls_container">
                <button id="start">Start</button>
                <button id="stop">Stop</button>            
            </div>
            <div class="controls_container">
                <button id="reset">New Lua Script</button>
            </div>
            <div class="controls_container">
                <button id="minify" style="margin-left: auto;">Minify (Beta)</button>
                <input type="checkbox" name="minify-identation" id="minify-identation" checked>
                <label>Line breaks</label>
            </div>
            <div class="controls_container">
                <div id="share" class="share">
                    <div class="docreate">
                        Share
                    </div>
                    <div class="more">
                        <div class="currentshare_container">
                            <input type="text" class="currentshare" name="currentshare"/>
                            <span class="copy_share_to_clipboard">Copy</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="editor-bottom-container">
            <div id="code-container">
                <div id="code">
function onTick()
	-- your code
end

function onDraw()
	-- your code
end
</div>
                <div id="code-editor-information">
                    <span id="selection-information">Line 0, Column 0, Char 0</span>
                    <span id="autocompletition-hint">Autocomplete: right click, Ctrl+Space or Command+Space</span>
                    <span id="charactercount">0/4096</span>
                </div>
                <div class="code_lock"></div>
                <div id="autocompletition-container"></div>
            </div>
            <div id="example-container">
                <div id="examples-heading"><h3>Learn & Examples:</h3><span class="close icon-cross"></span></div>
                <div id="examples"></div>
            </div>
        </div>
    </div>

    <div id="minified-editor" style="display: none;">
        <h3>Minified Code:</h3>
        <div id="minified-controls" class="controls">
            <div class="controls_container">
                <button id="save-minified">Save Minified</button>
            </div>
            <div class="controls_container">
                <button id="start-minified">Start Minified</button>
            </div>
        </div>        
        <div id="minified-code-container">
            <div class="custom_hint" style="display: none;">
                You are using custom minified code! It will be overwritten when minifying the next time!<br>When sharing the original code as well as the custom minified code will be shared.
            </div>
            <div id="minified-code">
            </div>
            <div id="code-minified-editor-information">
                <span id="minified-selection-information">Line 0, Column 0, Char 0</span>
                <span id="minified-charactercount">0/4096</span>
            </div>
            <div class="code_lock"></div>
        </div>
    </div>

    <div id="out">
        <h3>Console Output:</h3>
        <textarea readonly id="console"></textarea>
    </div>
    <br>

    <div id="ui-builder">
        <h2>UI Builder</h2>
        <div id="ui-builder-container"></div>
        <div id="ui-builder-controls">
            <div class="ui_builder_zoom">
                <label for="ui-builder-zoom">UI Builder Zoom: <span>1x</span></label>
                <input type="range" min="1" max="4" value="1" name="ui-builder-zoom" id="ui-builder-zoom">
            </div>
            <div class="controls_container">
                <button id="generate-ui-builder-lua-code">Generate Lua Code</button>
            </div>
            <div class="controls_container">
                <button id="start-generated">Start Generated Code</button>
            </div>
        </div>
        <div id="ui-builder-code" style="display: none;"></div>
    </div>
    
    <div class="information_container">
        View the public source code of this page <a target="_blank" rel="noopener noreferrer" href="https://gitlab.com/stormworks-lua-editor/editor">here</a>
    </div>

    <div class="information_container">
        <h2>Lua manual:</h2>
        <p>
            <a href="https://www.lua.org/manual/5.3/" target="_blank" rel="noopener noreferrer">https://www.lua.org/manual/5.3/</a>
        </p>
    </div>

    <div id="documentation" class="information_container">
        <h2>Available functions:</h2>
    </div>

    <div id="fixed-information-badges">
        <div id="learn-badge" class="hoverable">
            <div>
                <span class="icon-books"></span>
                <div style="display: flex;flex-direction: column;">
                    <span class="heading">Learn &</span>
                    <span class="heading">Examples</span>
                </div>
            </div>
        </div>
        <div id="help-badge" class="hoverable">
            <div>
                <span class="icon-question"></span>
                 <div style="display: flex;flex-direction: column;">
                    <span class="heading">Help /</span>
                    <span class="heading">Manual</span>
                </div>
            </div>
        </div>
        <div>
            <span class="heading">Contact me</span>
            <div class="discord"><img src="images/discord.png">CrazyFluffyPony#0587</div>
            <div class="email"><span class="icon-mail"></span><a href="mailto://crazyfluffypony@gmail.com">crazyfluffypony@gmail.com</a></div>
        </div>
    </div>


    <script src="ace-builds/ace.js" type="text/javascript" charset="utf-8"></script>
    <script src="ace-builds/ext-language_tools.js" type="text/javascript" charset="utf-8"></script>
    <script>
        var editor = ace.edit("code");
        editor.setTheme("ace/theme/monokai");
        editor.session.setMode("ace/mode/lua");
        editor.session.setUseSoftTabs(false); 

        var minifiedEditor = ace.edit("minified-code");
        minifiedEditor.setTheme("ace/theme/monokai");
        minifiedEditor.session.setMode("ace/mode/lua");
        minifiedEditor.session.setUseSoftTabs(false); 

        var uiBuilderEditor = ace.edit("ui-builder-code");
        uiBuilderEditor.setTheme("ace/theme/monokai");
        uiBuilderEditor.session.setMode("ace/mode/lua");
        uiBuilderEditor.session.setUseSoftTabs(false); 
    </script>

    <div id="help" style="display: none;">
        <div id="help-content">
            <span id="help-close" class="icon-cross"></span>
            <div class="section">
                <h3>Short introduction into the page:</h3>
                <div id="help-youtube-video">https://www.youtube.com/watch?v=hHgnNmwmZCY</div>
            </div>
            <div class="section">
                <h3>Lua</h3>
                <p>
                    You can find the complete documentation and some examples on the official lua website:
                    <a href="https://www.lua.org/manual/5.3/" target="_blank" rel="noopener noreferrer">https://www.lua.org/manual/5.3/</a>
                </p>
            </div>
            <div class="section">
                <h3>Monitor, Properties, Inputs, Outputs ...</h3>
                <br>
                <h4>Monitor</h5>
                <p>
                    You can select different monitor sizes. On zoom=1 one pixel of the monitor is exactly one pixel of your real monitor. You can zoom the monitor for easier development (this does not influence the screen.getHeight() in the lua script!).
                </p>
                <h4>Properties</h5>
                <p>
                    Like in the game you can set properties. Choose a property type, then write the label of the property into the input field of the property type you want. Depending on the type you can now set the value of the property: boolean, number or text.
                </p>
                <h4>Inputs</h5>
                <p>
                   The inputs simulate the lua scripts input composite. To write a value to the composite select the channel on the type of composite you want to have (boolean or number). Then You can enter the value for that channel.
                   <b>Numbers</b> have an additional settings button where you can switch between normal number input and slider. You can also activate the oscilate function for this input. Oscilate means the input value will change every tick by the set step. Once it reaches the upper or lower limit it will change direction.
                </p>
                <h4>Outputs</h5>
                <p>
                    This simulates the lua scripts output composite. When the lua script assigns values to the output, they will show up here.                    
                </p>
            </div>
            <div class="section">
                <h3>Touchscreen</h3>
                <p>
                    Enable the touchscreen by checking the "touchscreen" checkmark above the monitor. Hover with your mouse ofer the monitor and press e/q keys.
                </p>
            </div>
            <div class="section">
                <h3>Code Editor</h3>
                <p>
                    The code editor has more functionality than you would expect. Most of them are similar to Sublime Text 3:
                    <ul>
                        <li>Multiselect (Hold ctrl and click)</li>
                        <li>Search and Replace (Ctrl + F, Ctrl + H)</li>
                        <li>Undo, Redo (Ctrl + Z, Ctrl + Y)</li>
                        <li>Autocompletition (Ctrl + Space)</li>
                    </ul>
                </p>
            </div>
            <div class="section">
                <h3>Minifying</h3>
                <p>
                    <b>This feature is work in progress!</b>                    
                    <br>
                    The more complicated your code is the higher is the risk of something not working after minifying it.
                    <br>
                    Always test your code after minifying it!
                    <br>
                    <br>
                    When your code is exceeding the maximum length allowed in Stormworks you have several options:
                    <ul>
                        <li>Edit the code manually and shorten variable names or function names</li>
                        <li>Split up your code into 2 or more parts which then run in different luascript components ingame</li>
                        <li>Click the minify button (for better reading you can check the option "Line breaks")</li>
                    </ul>
                    If you used the minify button then your minified code will appear below the original code.
                    You will propably see that the minified code has less characters then the original one.
                </p>
            </div>
            <div class="section">
                <h3>Sharing</h3>
                <p>Sharing your code with other people is pretty easy:
                    <ul>
                        <li>Write your code or paste it into the code editor</li>
                        <li>Adjust all the settings (monitor size, inputs, properties, time between draws) as you need them</li>
                        <li>Click the blueish share button and a url is generated</li>
                        <li>Send this url to other people</li>
                        <li>When they open the url they will see your code as well as all of your settings</li>
                    </ul>
                    <br>
                    <b>Hint: You cannot change anything you shared</b>
                    <br>
                    <i>(because we do not know if you are the owner of the code)</i>
                </p>
            </div>
        </div>
    </div>

    <img src="images/map.png" id="map" style="display: none;">

    <div style="display: none" id="ponybin-create-overlay" class="ponybin_overlay">
        <div class="inner">
            <div class="circle">
                <p>Pushing code to Ponybin<span dot="1">.</span><span dot="2">.</span><span dot="3">.</span></p>
            </div>
        </div>
    </div>
    <div style="display: none" id="ponybin-receive-overlay" class="ponybin_overlay">
        <div class="inner">
            <div class="circle">
                <p>Receiving code from Ponybin<span dot="1">.</span><span dot="2">.</span><span dot="3">.</span></p>
            </div>
        </div>
    </div>

    <div style="display: none" id="message" class="dialog">
        <div class="inner">
            <h3 class="title"></h3>
            <div class="message">
            </div>
            <div class="buttons">
                <button class="ok">Ok</button>
            </div>
        </div>
    </div>

    <div style="display: none" id="confirm" class="dialog">
        <div class="inner">
            <h3 class="title">Confirm action:</h3>
            <div class="message">
            </div>
            <div class="buttons">
                <button class="yes">Yes</button>
                <button class="no">No</button>
            </div>
        </div>
    </div>

    <div style="display: none" id="alert" class="dialog">
        <div class="inner">
            <h3 class="title">Alert:</h3>
            <div class="message">
            </div>
            <div class="buttons">
                <button class="ok">Ok</button>
            </div>
        </div>
    </div>
</body>
</html>