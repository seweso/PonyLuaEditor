<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">

    <title>LUA Canvas</title>
    <meta name="title" content="LUA Canvas">


    <!-- favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#0194e2">
    <meta name="msapplication-TileColor" content="#0194e2">
    <meta name="theme-color" content="#0194e2">




    <link rel="stylesheet" type="text/css" href="style.css">
    <link rel="stylesheet" type="text/css" href="font.css"/>

    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" id="fengari-script" src="fengari_web.js"></script>
    <script type="text/javascript" src="share.js"></script>
    <script type="text/javascript" src="script.js"></script>
    <script type="text/javascript" src="canvas.js"></script>
    <script type="text/javascript" src="paint.js"></script>
    <script type="text/javascript" src="map.js"></script>
    <script type="text/javascript" src="input.js"></script>
    <script type="text/javascript" src="output.js"></script>
    <script type="text/javascript" src="property.js"></script>
    <script type="text/javascript" src="stormworks_lua_api.js"></script>
    <script type="text/javascript" src="lua_emulator.js"></script>
    <script type="text/javascript" src="editor_autocompletition.js"></script>


    <script type="text/javascript" src="version.js"></script>    
</head>
<body>
  <div class="background"></div>
  <div class="content">
    <div id="selection">
        <div id="logo"></div>
        <label for="monitor-size">Monitor</label>
        <select id="monitor-size" name="monitor-size">
            <option value="1x1">1x1</option>
            <option value="2x2">2x2</option>
            <option value="5x3">5x3</option>
            <option value="9x5">9x5</option>
        </select>
        <label for="show-overflow">Show overflow</label>
        <input type="checkbox" id="show-overflow" name="show-overflow" checked>
        <div class="time_between">
            <label>Time between ticks (ms): <span id="timeBetweenTicksVal">200 ms</span></label>
            <input type="range" min="20" max="2000" value="200" id="timeBetweenTicks">
        </div>
        <div class="time_between">
            <label>Time between draws (ms): <span id="timeBetweenDrawsVal">500 ms</span></label>
            <input type="range" min="50" max="5000" value="500" id="timeBetweenDraws">
            <span>Average time for a draw:<span id="drawtime">0 ms</span></span>
        </div>
    </div>
    <div id="top">
        <div id="property" class="value_list"></div>
        <div id="input" class="value_list"></div>
        <div id="monitor">
            <canvas id="canvas"></canvas>
            <div id="overflow"></div>
            <div class="zoomfactor">
                <label for="zoomfactor">Monitor Zoom: <span>3x</span></label>
                <input type="range" min="1" max="4" id="zoomfactor" name="zoomfactor" value="1">
            </div>
        </div>
        <div id="output" class="value_list"></div>
    </div>
    <div id="editor">
        <div id="controls">
            <button id="start">Start</button>
            <button id="stop">Stop</button>
            <button id="reset">Reset all data</button>

            <div id="share" class="share">
                <span class="close">x</span>
                <div class="outer">
                    Share
                </div>
                <div class="inner">
                    <div class="currentshare_container">
                        <label>Pastebin-Code:</label>
                        <input type="text" class="currentshare" name="currentshare"/>
                    </div>
                    <span class="docreate">Create New</span>
                    <span class="doreceive">Receive existing</span>
                </div>
            </div>
        </div>
        <div id="code-container">
            <div id="code">
function onTick()
    -- Example that adds two composite channels together and outputs the result
    in1 = input.getNumber(1)
    in2 = input.getNumber(2)
    output.setNumber(1, in1 + in2)
end    
        
function onDraw()
    -- Example that draws a red circle in the center of the screen with a radius of 20 pixels
    width = screen.getWidth()
    height = screen.getHeight()
    screen.setColor(255, 0, 0)
    screen.drawCircleF(width / 2, height / 2, 20)
end
            </div>
            <div id="code-editor-information">
                <span id="selection-information">Line 0, Column 0, Char 0</span>
                <span id="autocompletition-hint">Use right click, Ctrl+Space or Command+Space to open the autocompletition menu</span>
                <span id="charactercount">0/4096</span>
            </div>
            <div id="code-lock"></div>
            <div id="autocompletition-container"></div>
        </div>
    </div>
    <div id="out">
        <h3>Console Output:</h3>
        <textarea readonly id="console"></textarea>
    </div>
    <br>
    <div id="functions" class="information_container">
        <h2>Available functions:</h2>
    </div>

    <div id="touchscreen" class="information_container">
        <h2>Touchscreen</h2>
        <p>The composite output from the monitors contains data that can be interpreted in your script to create touchscreens. The layout of the composite data is as follows:</p>
        <span>Number Channels</span>
        <ol>
            <li>monitorResolutionX</li>
            <li>monitorResolutionY</li>
            <li>input1X</li>
            <li>input1Y</li>
            <li>input2X</li>
            <li>input2Y</li>            
        </ol>
        <span>On/Off Channels</span>
        <ol>
            <li>isInput1Pressed</li>
            <li>isInput2Pressed</li>
        </ol>
        <p>Hint: As long as an input is pressed the x and y coordinated will not change! This means you cannot implement drag functionality!</p>
    </div>

    <div id="libraries" class="information_container">
        <h2>Libraries</h2>
        <p>The following global lua functions are available:</p>
        <ul>
            <li>pairs</li>
            <li>ipairs</li>
            <li>next</li>
            <li>tostring</li>
            <li>tonumber</li>
        </ul>
        <p>and additional functions are available through the following lua libraries:</p>
        <ul>
            <li>math</li>
            <li>table</li>
            <li>string</li>
        </ul>
    </div>
    
    <div id="meta" class="information_container">
        <h2>Meta from the devs</h2>
        <p>This scripting API is very powerful and as such there are some important reminders to take note of:</p>
        <ul>
            <li>Your script has a max execution time of 1000 milliseconds, however it is still possible to create scripts that significantly slow down the game. It is your responsibility to ensure your script runs efficiently.</li>
            <li>Random number functions are provided by the Lua math library. Use of randomness in your scripts is likey to cause desync in multiplayer, so use these functions at your own risk</li>
            <li>When your vehicle despawns and respawns, your script will be executed 'fresh' and any state stored within the script will be lost. We recommend keeping your script as stateless as possible, and making use of existing logic components (e.g. memory register) to store values that you with to persist</li>
            <li>Your scripts run as a 'black box' with only the logic inputs/outputs being synced in multiplayer. Keep in mind that complex logic in your script may behave differently for different players in a multiplayer session.</li>
            <li>A number of safeguards are in place to sandbox your script, however it is still possible to write scripts that will potentially crash your game. If you crash your game with a script it's likely that you're doing something (very) wrong. This is your own responsibility. If you suspect you have encountered a legitimate bug, please report it on the Stormworks issue tracker (accessible from the pause-menu).</li>
            <li>Malicious and harmful scripts will not be tolerated on the Stormworks Steam Workshop</li>
        </ul>
        <p>Finally, enjoy the almost limitless possibilities that these scripts provide. This short wiki aims to give a good overview of how scripting in Stormworks works, however if you have any questions that are not covered here, please fell free to join us on Discord (accessible from the pause-menu)!</p>
    </div>


    <div id="information">
        <!--<img src="https://gitlab.com/stormworks-model-analyzer/stormworks-model-analyzer.gitlab.io/badges/master/pipeline.svg">
        <a target="_blank" rel="noopener noreferrer" class="version" href="https://gitlab.com/stormworks-model-analyzer/analyzer/commits/master">
            <img src="https://img.shields.io/badge/version-unknown-%239e9e9e.svg">
        </a>-->
        <a target="_blank" rel="noopener noreferrer" href="https://gitlab.com/stormworks-lua-editor/editor">Source Code</a>
        <div class="network"><img src="discord.png">CrazyFluffyPony#0587</div>
    </div>



    <script type="text/javascript">
        setTimeout(()=>{
          if(typeof window.version === 'string'){
            $('#information .version').attr('href', 'https://gitlab.com/stormworks-model-analyzer/analyzer/tags/v' + window.version);
            $('#information .version img').attr('src', 'https://img.shields.io/badge/version-' + window.version + '-%231182c3.svg');
          }
        }, 500)
    </script>

    <script src="/ace-builds/ace.js" type="text/javascript" charset="utf-8"></script>
    <script src="/ace-builds/ext-language_tools.js" type="text/javascript" charset="utf-8"></script>
    <script>
        var editor = ace.edit("code");
        editor.setTheme("ace/theme/monokai");
        editor.session.setMode("ace/mode/lua");
    </script>

    <img src="/map.png" id="map" style="display: none;">
</body>
</html>